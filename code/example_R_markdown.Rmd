# Examples of manipulating and fitting timeseries data

**This is an EXAMPLE to test if you can run the code!**

## Draft explanation of the tool

Climate data is often recorded at high temporal- and spatial-resolutions. This is in contrast to economic data, which is often reported publicly only as summaries every financial quarter or year. This leaves us with a difficult statistical problem: how do we compare the two fundamentally different timeseries?

We propose a tool which would allow users to search economic datasets against a wealth of climate data. Specifically, we aim to find climate timeseries which are correlated with the input, allowing for 'stretching' or 'lag' of these timeseries. A clear example can be understood as a time-delay system, e.g., the output of CO 2 emissions from transport is delayed from the extraction of the raw fossil fuels used to produce the petrol.

Our hope is that this tool would suggest previously unexpected correlations across domains. Users could use the suggested correlated climate data when developing more robust models.

## Example code with timeseries

```{r, load_packages, results='hide'}
# install useful packages
library(fda)
library(dtwclust)
library(ggplot2)
```

We can, for example, reduce daily fluctuations in climate data to fit more sparse timeseries. First, we need to create a periodic basis to fit our functions to.

```{r, climate_data_example}
# generate an fda example with sine waves

nbasis <- 10
rng_of_timeseries <- c(1, 2*365)
arg_vals_days <- 1:(2*365)
eg_fourier_basis <- create.fourier.basis(rangeval = rng_of_timeseries,
                                         nbasis = nbasis)
plot(eg_fourier_basis,
     ylab = "Basis function value",
     xlab = "Time (days)")

```

We can then create some example data - e.g. a large yearly fluctuation, plus a rapid daily fluctuation.

```{r, fluctuating_data}
eg_fluc_data <- sapply(
  arg_vals_days,
  function(i) {40 + 3*(i/365)**2 + 5*cos(i*2*pi/365) + 0.3 * sin(i*pi/3)}
)

plot(arg_vals_days, eg_fluc_data, type = 'l',
     xlab = "Time (days)", ylab = "Measurement")
```

We can then plot the fit of the Fourier basis to this timeseries data. **This isn't a perfect fit - so we will require the user to adjust parameters to make a good fit by eye!**

```{r, fit_to_fluctuating_data}
fit_output <- smooth.basis(arg_vals_days, y = eg_fluc_data, 
                           fdParobj = eg_fourier_basis)

plot(fit_output, col = "red",
     xlab = "Time (days)", ylab = "Measurement")
lines(arg_vals_days, eg_fluc_data)
```
